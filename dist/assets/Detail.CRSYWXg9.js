import{d as re,i as le,h as se,an as oe,r as p,F as ie,l as ne,b as u,c as h,e as _,ag as ue,f as l,w as o,g as r,I as E,ah as de,af as ce,n as b,N,ae as S,j as m,B as f,ao as pe,m as g,S as me,q as P,M as fe,E as ge,ai as V,_ as ve}from"./index.BwZPC61G.js";import{o as ye}from"./onMountedOrActivated.CnnyHWYG.js";import j from"./PropertyTag.CfQr_2o-.js";import{A as M,c as he,u as be,d as Pe,b as _e,e as Ce,a as Ue}from"./index.Dqrk_4EH.js";import{a as ke,F as c}from"./index.BZecJ49D.js";import{P as L}from"./PlusOutlined.BTjKfhXo.js";import{U as O,C as we}from"./index.BH7_jWxr.js";import{M as Ae}from"./MinusCircleOutlined.QLTqLQNx.js";import"./collapseMotion.BxqzzwVi.js";import"./index.DpUGKy9S.js";import"./DownloadOutlined.CpcBnnCH.js";const qe={class:""},xe={class:"p-4 bg-white flex"},De={key:0},Fe=_("div",{style:{"margin-top":"8px"}},"Upload",-1),Be={key:0},Ee=_("div",{style:{"margin-top":"8px"}},"Upload",-1),Ne={class:"w-full flex justify-end"},Se=re({__name:"Detail",setup(Ve){const x={Authorization:le().getToken},U=se(),k=oe(),i=p(U.query.mode),w=p(!1),C=p(!1),s=p({name:"",category:void 0,description:"",imgs:[],certificate:[],properties:[],additionalProperties:[]}),v=p([]),y=p(),T=async()=>{const{id:a}=U.query;try{w.value=!0;const e=await _e(Number(a));s.value=e,v.value=V(s.value.imgs),y.value=s.value.certificate?V(s.value.certificate):[]}catch(e){console.error(e)}finally{w.value=!1}},I=async(a,e)=>e.length!=3?Promise.reject("Product images must be 3"):Promise.resolve(),H=async(a,e)=>e.length>3?Promise.reject("Certification should be less than 3"):Promise.resolve(),R=async(a,e)=>e.items.length===0?Promise.reject("Please set at least one property"):Promise.resolve(),$=async(a,e)=>e?Promise.resolve():Promise.reject("Please input the property name"),z=async(a,e)=>e.length===0?Promise.reject("Please set at least one property"):Promise.resolve(),G={name:[{required:!0,message:"product name can not be empty",trigger:"change"}],category:[{required:!0,message:"product category can not be empty",trigger:"change"}],description:[{required:!0,message:"product description can not be empty",trigger:"change"}],properties:[{type:"array",required:!0,message:"property name can not be empty",trigger:"change"}],additionalProperties:[{type:"array",required:!0,message:"property name can not be empty",trigger:"change"}],imgs:[{type:"array",required:!0,trigger:"change",validator:I}],certificate:[{type:"array",required:!0,message:"Product certification can not be empty",trigger:"change",validator:H}]},W=a=>{a.length>0&&a.forEach(e=>{let t=[];e.items.length&&e.items.forEach(n=>{t.push(n.value)}),s.value.properties.push({name:e.name,items:t})})},D=p([]),A=p({}),J=a=>{if(!a)return;const e=A.value[a],t=[];e.forEach(n=>{t.push({name:n,items:[]})}),s.value.properties=t},K=async()=>{try{const a=await Ce();A.value=a}catch(a){console.error(a)}},Q=async()=>{const a=await Ue();D.value=a||[]},X=ie(()=>{switch(i.value){case"add":return"Add Product";case"detail":return"Product Detail";case"edit":return"Update Product";default:return""}}),Y=()=>{s.value.additionalProperties.push({name:"",items:[]})},Z=a=>{s.value.additionalProperties.splice(a,1)},ee=()=>{console.log("beforeUploadHandler")},F=(a,e)=>{console.log(a);const{file:t,fileList:n}=a;(t.status==="done"||t.status==="removed")&&(s.value[e]=[],n.length>0&&n.forEach(d=>{var B;let q="";d.url?q=d.url:q=d.response.data[0].url,(B=s.value[e])==null||B.push(q)}))},te=async()=>{try{C.value=!0;let a;i.value==="add"&&(a=await he(s.value)),i.value==="edit"&&(a=await be(s.value)),a?(P.success(i.value+" product successfully"),k.push({path:"/product",replace:!0})):P.error(i.value+"product failed")}catch(a){P.error(i.value+"product failed"),console.error(a)}finally{C.value=!1}},ae=()=>{fe.confirm({title:"Warning?",icon:l(ge),content:"Are you sure you want to delete this product?",okButtonProps:{loading:C.value},onOk:async()=>{const{id:a}=U.query;await Pe(Number(a))?(P.success("Delete product successfully"),k.push({path:"/product",replace:!0})):P.error("Delete product failed")},onCancel(){}})};return ne(async()=>{}),ye(async()=>{await Q(),await K(),W(A.value),i.value!=="add"&&T()}),(a,e)=>(u(),h("div",qe,[_("h2",null,ue(X.value),1),_("div",xe,[l(r(me),{wrapperClassName:"w-full",spinning:w.value},{default:o(()=>[l(r(ke),{name:"basic",class:"w-full p-4",rules:G,disabled:i.value==="detail","label-col":{style:{width:"150px"}},model:s.value,onFinish:te},{default:o(()=>[l(r(c),{label:"product name",name:"name"},{default:o(()=>[l(r(E),{value:s.value.name,"onUpdate:value":e[0]||(e[0]=t=>s.value.name=t),placeholder:"please enter"},null,8,["value"])]),_:1}),l(r(c),{label:"product category",name:"category"},{default:o(()=>[l(r(de),{value:s.value.category,"onUpdate:value":e[1]||(e[1]=t=>s.value.category=t),options:D.value,onChange:J,placeholder:"please select"},null,8,["value","options"])]),_:1}),l(r(c),{label:"product description",name:"description"},{default:o(()=>[l(r(ce),{value:s.value.description,"onUpdate:value":e[2]||(e[2]=t=>s.value.description=t),placeholder:"please enter"},null,8,["value"])]),_:1}),l(r(c),{label:"product images",name:"imgs"},{default:o(()=>[l(r(O),{headers:x,"file-list":v.value,"onUpdate:fileList":e[3]||(e[3]=t=>v.value=t),beforeUpload:ee,action:r(M).AntUpload,"list-type":"picture-card",onChange:e[4]||(e[4]=t=>{F(t,"imgs")})},{default:o(()=>[v.value&&v.value.length<3?(u(),h("div",De,[l(r(L)),Fe])):b("",!0)]),_:1},8,["file-list","action"])]),_:1}),l(r(c),{label:"product certifacate",name:"certificate"},{default:o(()=>[l(r(O),{headers:x,"file-list":y.value,"onUpdate:fileList":e[5]||(e[5]=t=>y.value=t),action:r(M).AntUpload,"list-type":"picture-card",onChange:e[6]||(e[6]=t=>{F(t,"certificate")})},{default:o(()=>[y.value&&y.value.length<3?(u(),h("div",Be,[l(r(L)),Ee])):b("",!0)]),_:1},8,["file-list","action"])]),_:1}),(u(!0),h(N,null,S(s.value.properties,(t,n)=>(u(),m(r(c),{key:t.name,name:["properties",n],label:t.name,rules:[{type:"array",required:!0,message:"please set at least one property",trigger:"blur",validator:R}]},{default:o(()=>[l(j,{items:t.items,"onUpdate:items":d=>t.items=d,disabled:i.value==="detail"},null,8,["items","onUpdate:items","disabled"])]),_:2},1032,["name","label","rules"]))),128)),(u(!0),h(N,null,S(s.value.additionalProperties,(t,n)=>(u(),m(r(we),{key:n,class:"mb-4 px-0 py-4 pb-0"},{default:o(()=>[l(r(c),{name:["additionalProperties",n,"name"],label:"property name",rules:[{type:"array",required:!0,message:"property name can not be empty",trigger:"change",validator:$}]},{default:o(()=>[l(r(E),{value:t.name,"onUpdate:value":d=>t.name=d,class:"w-[200px]"},null,8,["value","onUpdate:value"]),l(r(f),{danger:"",icon:pe(r(Ae)),class:"h-[36px] ml-4",onClick:d=>Z(n)},null,8,["icon","onClick"])]),_:2},1032,["name","rules"]),l(r(c),{label:"property values",name:["additionalProperties",n,"items"],rules:[{required:!0,message:"property item can not be empty",trigger:"blur",validator:z}]},{default:o(()=>[l(j,{items:t.items,"onUpdate:items":d=>t.items=d,disabled:i.value==="detail"},null,8,["items","onUpdate:items","disabled"])]),_:2},1032,["name","rules"])]),_:2},1024))),128)),i.value!=="detail"?(u(),m(r(c),{key:0},{default:o(()=>[l(r(f),{onClick:Y},{default:o(()=>[g("add new porperty")]),_:1})]),_:1})):b("",!0),l(r(c),null,{default:o(()=>[_("div",Ne,[i.value!=="detail"?(u(),m(r(f),{key:0,class:"mr-2",type:"primary","html-type":"submit",loading:C.value},{default:o(()=>[g(" Submit ")]),_:1},8,["loading"])):(u(),m(r(f),{key:1,disabled:!1,type:"primary",onClick:e[7]||(e[7]=()=>{i.value="edit"}),class:"mr-2"},{default:o(()=>[g(" Edit ")]),_:1})),i.value!="add"?(u(),m(r(f),{key:2,disabled:!1,class:"mr-2",type:"primary",danger:"",onClick:e[8]||(e[8]=()=>{ae()})},{default:o(()=>[g(" Delete ")]),_:1})):b("",!0),i.value!=="detail"?(u(),m(r(f),{key:3,class:"mr-2",onClick:e[9]||(e[9]=()=>{i.value="detail"})},{default:o(()=>[g(" Detail ")]),_:1})):b("",!0),l(r(f),{onClick:e[10]||(e[10]=t=>r(k).go(-1)),disabled:!1},{default:o(()=>[g("Go Back")]),_:1})])]),_:1})]),_:1},8,["disabled","model"])]),_:1},8,["spinning"])])]))}}),Je=ve(Se,[["__file","E:/deloitte_project/bruno/cms-front-end/src/views/product/Detail.vue"]]);export{Je as default};
